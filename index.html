<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cricket Score Overlay</title>
<style>
  body { margin:0; background:transparent; font-family: "Segoe UI", Arial, sans-serif; color:white; }
  
  /* ✅ Main container */
  .scorebar {
    position: fixed;
    top:10px; left:50%; transform:translateX(-50%);
    width:92%;
    background: linear-gradient(180deg, rgba(25,25,25,0.95), rgba(10,10,10,0.85));
    border: 1px solid rgba(255,255,255,0.15);
    border-radius:16px;
    padding:12px 18px;
    box-sizing:border-box;
    box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
  }

  .row { 
    display:grid; 
    grid-template-columns:1fr 1fr 1fr; 
    align-items:center; 
    margin:4px 0; 
  }
  .left   { text-align:left; }
  .center { text-align:center; }
  .right  { text-align:right; }

  /* ✅ Player name + score */
  .player {
    font-size: clamp(16px, 2vw, 26px);
    font-weight: 600;
    text-shadow:0 0 4px rgba(0,0,0,0.8);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ✅ Main ticker (scoreline) */
  .scoreline {
    font-size: clamp(18px, 2.5vw, 30px);
    font-weight: 700;
    letter-spacing: 0.5px;
    text-shadow:0 0 6px rgba(0,0,0,0.9);
    white-space: nowrap;
  }

  /* ✅ Bowler & CRR smaller */
  .bowler {
    font-size: clamp(13px, 1.8vw, 18px);
    font-style: italic;
    opacity: 0.9;
    text-shadow:0 0 3px rgba(0,0,0,0.7);
  }
  .crr {
    font-size: clamp(12px, 1.5vw, 17px);
    font-style: italic;
    opacity: 0.85;
    text-shadow:0 0 3px rgba(0,0,0,0.7);
  }

  /* ✅ This Over section */
  .over-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }
  .over-label {
    font-size: clamp(12px, 1.6vw, 16px);
    font-weight: 600;
    color: #ffeb3b; /* yellow highlight like TV graphics */
    margin-bottom: 3px;
    text-shadow: 0 0 4px rgba(0,0,0,0.8);
  }
  #lastover {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    background: linear-gradient(180deg, rgba(40,40,40,0.95), rgba(15,15,15,0.9));
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 14px;
    padding: 6px 12px;
  }

  /* ✅ Ball styling */
  .ball {
    display:inline-flex;
    justify-content:center;
    align-items:center;
    width: 22px; height: 22px;
    border-radius:50%;
    font-weight:600;
    font-size: clamp(11px, 1.3vw, 14px);
    color:white;
    text-align:center;
  }
  .dot    { background: #616161; }
  .run    { background: #2e7d32; }
  .four   { background: #1565c0; }
  .six    { background: #ffd600; color:black; }
  .wicket { background: #c62828; }
  .wide   { background: #ef6c00; }
  .noball { background: #8e24aa; }
</style>
</head>
<body>

<div class="scorebar">
  <div class="row">
    <div class="left player" id="player1"></div>
    <div class="center scoreline" id="ticker"></div>
    <div class="right bowler" id="bowler"></div>
  </div>
  <div class="row">
    <div class="left player" id="player2"></div>
    <div class="center crr" id="crr"></div>
    <div class="right over-container">
      <div class="over-label" id="overLabel">This Over</div>
      <div id="lastover"></div>
    </div>
  </div>
</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/1FUl5P--46Q7uzgUYEcmkVVdwzsRqTpad/gviz/tq?tqx=out:json&gid=658195036";

// ---- Parser ----
function parseData(json) {
  let data = {};
  let cols = json.table.cols;
  let rows = json.table.rows;

  if (cols.length > 1 && cols[1].label && cols[1].label.startsWith("Value")) {
    let label = cols[1].label.replace("Value", "").trim();
    let match = label.match(/^(.*?\(\d+\)) (.*?\(\d+\)) (.*)$/);
    if (match) {
      data["Player 1"] = match[1].trim();
      data["Player 2"] = match[2].trim();
      data["Ticker"]   = match[3].trim();
    }
  }

  rows.forEach(row => {
    if (row.c[0] && row.c[1]) {
      data[row.c[0].v] = row.c[1].v;
    }
  });

  return data;
}

// ---- Ball styling helper ----
function formatBall(b) {
  let cls = "run";
  let txt = b;
  if (b === "0") cls = "dot";
  else if (/^[1-3]$/.test(b)) cls = "run";
  else if (b === "4") cls = "four";
  else if (b === "6") cls = "six";
  else if (/^w$/i.test(b)) cls = "wicket";
  else if (/^wd$/i.test(b)) cls = "wide";
  else if (/^nb$/i.test(b)) cls = "noball";
  return `<span class="ball ${cls}">${txt}</span>`;
}

// ---- Fetch & update loop ----
async function fetchScore() {
  try {
    const res = await fetch(sheetURL + "&t=" + Date.now(), { cache: "no-store" });
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const data = parseData(json);

    document.getElementById("player1").innerText = data["Player 1"] || "";
    document.getElementById("player2").innerText = data["Player 2"] || "";
    document.getElementById("ticker").innerText  = data["Ticker"]   || "";
    document.getElementById("crr").innerText     = data["CRR"] ? "CRR: " + data["CRR"] : "";
    document.getElementById("bowler").innerText  = data["Bowler"] ? "Bowler: " + data["Bowler"] : "";

    if (data["This Over"]) {
      const balls = data["This Over"].split(" ").filter(x => x.trim() !== "");
      document.getElementById("lastover").innerHTML = balls.map(formatBall).join(" ");
    } else {
      document.getElementById("lastover").innerHTML = "";
    }

  } catch (e) {
    console.error("Error fetching score:", e);
    document.getElementById("ticker").innerText = "⚠ No update from sheet";
  }
}

setInterval(fetchScore, 2000);
fetchScore();
</script>

</body>
</html>
