<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cricket Overlay</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: rgba(0,0,0,0); /* transparent */
      font-family: Arial, sans-serif;
    }
    #scorebar {
      position: fixed;
      bottom: 30px;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.75);
      color: white;
      font-size: 22px;
      font-weight: bold;
      padding: 6px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section { margin: 0 10px; white-space: nowrap; }
    .players { flex: 2; text-align: left; }
    .teams   { flex: 2; text-align: center; }
    .bowler  { flex: 1; text-align: right; }

    .lastover {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(255,255,255,0.1);
      font-size: 20px;
      padding: 4px;
      text-align: center;
      font-weight: bold;
    }
    .run    { color: #00ff00; } /* green */
    .wicket { color: #ff3333; } /* red */
    .dot    { color: #cccccc; } /* grey */
    .extra  { color: #00bfff; } /* blue for wd, nb */
  </style>
</head>
<body>
  <div id="scorebar">
    <div class="section players" id="players">Loading players...</div>
    <div class="section teams" id="teams">Loading teams...</div>
    <div class="section bowler" id="bowler">Loading bowler...</div>
  </div>
  <div class="lastover" id="lastover">Loading last over...</div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBBphs5H4uRDzOf_wVI4ExfDz3hDAFYn3GWi9uorlEfN3MJLlfgzFfsKq94ccgGg/pub?gid=658195036&single=true&output=csv";

    function colorBall(ball) {
      ball = ball.trim();
      if (ball === "W") return `<span class="wicket">${ball}</span>`;
      if (ball === "0") return `<span class="dot">${ball}</span>`;
      if (["wd","nb"].includes(ball.toLowerCase())) return `<span class="extra">${ball}</span>`;
      if (!isNaN(ball)) return `<span class="run">${ball}</span>`;
      return ball; // fallback
    }

    async function fetchScore() {
      try {
        const response = await fetch(sheetUrl + "&t=" + new Date().getTime()); // avoid cache
        const text = await response.text();
        const rows = text.trim().split("\n").map(r => r.split(","));

        const line = rows[0][0] || "";
        const parts = line.split("|").map(p => p.trim());

        document.getElementById("players").innerText = parts[0] + " | " + (parts[1] || "");
        document.getElementById("teams").innerText   = parts[2] || "";
        document.getElementById("bowler").innerText  = (parts[3] || "") + " " + (parts[4] || "");

        if (parts[5]) {
          let overText = parts[5].replace("Last Over:", "").trim().split(" ");
          overText = overText.map(colorBall).join(" ");
          document.getElementById("lastover").innerHTML = "Last Over: " + overText;
        }
      } catch (err) {
        document.getElementById("players").innerText = "Error loading";
        document.getElementById("teams").innerText = "";
        document.getElementById("bowler").innerText = "";
        document.getElementById("lastover").innerText = "";
      }
    }

    fetchScore();
    setInterval(fetchScore, 5000);
  </script>
</body>
</html>
